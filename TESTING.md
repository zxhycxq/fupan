# 表单输入功能测试指南

## 问题修复说明

已修复表单输入数据无法保存的问题。

### 修复内容

1. **移除了表单字段的 initialValue={0}**
   - 之前所有字段默认值为0，导致数据收集逻辑混乱
   - 现在未填写的字段值为 undefined，只收集用户真正填写的数据

2. **修改了 getFieldsValue() 调用**
   - 添加了 true 参数：`form.getFieldsValue(true)`
   - 确保获取所有嵌套字段的值

3. **添加了详细的调试日志**
   - 在浏览器控制台可以看到完整的数据流转过程
   - 方便排查问题

## 测试步骤

### 1. 打开上传页面
- 访问系统的上传页面
- 切换到"表单输入"标签页

### 2. 填写考试信息
- 考试名称：第40期（或其他名称）
- 索引号：21（或其他数字）

### 3. 填写模块数据
展开任意一个模块（例如"政治理论"），填写子模块数据：

**示例：马克思主义**
- 题目数量：5
- 答对数量：4
- 用时(秒)：180

**示例：理论与政策**
- 题目数量：8
- 答对数量：6
- 用时(秒)：240

### 4. 查看控制台日志
打开浏览器开发者工具（F12），切换到 Console 标签页。

点击"保存成绩"按钮后，应该看到类似以下日志：

```
=== 表单提交 ===
考试名称: 第40期
索引号: 21
表单值: {政治理论_马克思主义: {total_questions: 5, correct_answers: 4, time_used: 180}, ...}
检查模块 政治理论_马克思主义: {total_questions: 5, correct_answers: 4, time_used: 180}
添加模块得分: {module_name: "马克思主义", parent_module: "政治理论", ...}
检查模块 政治理论_理论与政策: {total_questions: 8, correct_answers: 6, time_used: 240}
添加模块得分: {module_name: "理论与政策", parent_module: "政治理论", ...}
总共收集到 2 个模块
总分: 10
总用时: 420
```

### 5. 验证详情页
保存成功后会自动跳转到详情页，检查：

- ✅ 考试名称显示正确
- ✅ 索引号显示正确
- ✅ 总分显示正确（答对数量之和）
- ✅ 总用时显示正确（所有模块用时之和）
- ✅ 模块得分列表显示完整
- ✅ 每个模块的题目数、答对数、正确率、用时都正确

## 常见问题

### Q1: 点击保存后提示"请至少填写一个模块的数据"
**原因**：没有填写任何模块的题目数量，或者题目数量为0

**解决**：至少填写一个子模块的"题目数量"字段，且值必须大于0

### Q2: 详情页显示的数据不完整
**原因**：可能是浏览器缓存问题

**解决**：
1. 刷新页面（F5）
2. 清除浏览器缓存后重试
3. 查看控制台是否有错误信息

### Q3: 控制台没有看到日志
**原因**：浏览器开发者工具未打开，或者日志被过滤

**解决**：
1. 按 F12 打开开发者工具
2. 切换到 Console 标签页
3. 确保日志级别设置为"All"或"Verbose"

## 数据验证规则

1. **考试名称**：不能为空
2. **索引号**：必须大于0
3. **题目数量**：必须大于0才会保存该模块
4. **答对数量**：可以为0，但不能大于题目数量
5. **用时**：可以为0

## 技术说明

### 数据收集逻辑
```typescript
// 只收集题目数量 > 0 的模块
if (data && data.total_questions > 0) {
  moduleScores.push({
    module_name: subModule,
    parent_module: parentModule.name,
    total_questions: totalQs,
    correct_answers: correctAnswers || 0,
    wrong_answers: totalQs - correctAnswers,
    unanswered: 0,
    accuracy_rate: (correctAnswers / totalQs) * 100,
    time_used: timeUsed || 0
  });
}
```

### 总分和总用时计算
- **总分** = 所有模块的答对数量之和
- **总用时** = 所有模块的用时之和（秒）

## 后续优化建议

1. 添加表单验证
   - 答对数量不能大于题目数量
   - 用时不能为负数
   - 自动计算答错数量

2. 改进用户体验
   - 添加保存前确认对话框
   - 显示保存进度
   - 支持草稿保存

3. 数据导入导出
   - 支持从Excel导入数据
   - 支持导出为Excel格式
   - 批量录入功能
