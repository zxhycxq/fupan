# 考试记录系统 - 星级评分和索引功能更新

## 功能概述

git config --global user.name miaoda

### 1. 星级评分功能
- 用户可以为每条考试记录添加星级评分（0-5星）
- 支持半星评分（0.5、1.5、2.5等）
- 在考试列表页面直接点击星星即可评分
- 评分实时保存到数据库

### 2. 考试名称功能
- 将原来的"期数"改为更灵活的"考试名称"
- 用户可以自定义考试名称（如"第1期"、"2024年国考模拟"等）
- 最多支持50个字符
- 在所有页面（列表、详情、仪表盘）统一显示考试名称

### 3. 索引号排序功能
- 新增索引号字段，用于控制考试记录的排序
- 索引号必须唯一，不能重复
- 默认从1开始自动递增
- 用户可以手动修改索引号来调整排序
- 所有列表和图表都按索引号排序

## 数据库变更

### 新增字段
- `rating` (numeric): 星级评分，范围0-5，支持小数
- `exam_name` (text): 考试名称，最多50个字符
- `index_number` (integer): 索引号，用于排序，设置唯一约束

### 约束和索引
- `index_number` 字段设置了唯一约束
- 创建了索引以优化查询性能

## API 变更

### 新增 API 函数
1. `updateExamRating(id, rating)` - 更新考试记录的星级
2. `checkIndexNumberExists(indexNumber, excludeId?)` - 检查索引号是否已存在
3. `updateExamIndexNumber(id, indexNumber)` - 更新考试记录的索引号
4. `getNextIndexNumber()` - 获取下一个可用的索引号

### 修改的 API 函数
1. `getAllExamRecords()` - 改为按 `index_number` 排序
2. `getModuleTrendData()` - 返回值中添加 `exam_names` 数组

## 页面变更

### 1. Upload 页面 (上传页面)
- 添加"考试名称"输入框（必填）
- 添加"索引号"输入框（必填，默认自动递增）
- 提交前验证索引号是否重复
- 表单布局调整为三列

### 2. ExamList 页面 (考试列表)
- 添加"星级"列，显示 Rate 组件
- 将"期数"列改为"索引"列
- 添加"考试名称"列
- 支持编辑索引号和考试名称
- 编辑时验证索引号唯一性

### 3. ExamDetail 页面 (考试详情)
- 标题显示考试名称
- 显示索引号和创建时间

### 4. Dashboard 页面 (仪表盘)
- 所有图表的 X 轴使用考试名称而不是期数
- 图表数据按索引号排序

## 类型定义更新

### ExamRecord 类型
```typescript
export interface ExamRecord {
  id: string;
  exam_number: number;
  exam_name: string;        // 新增
  index_number: number;     // 新增
  rating: number;           // 新增
  total_score: number;
  // ... 其他字段
}
```

## 使用说明

### 上传新的考试记录
1. 进入上传页面
2. 输入考试名称（如"第1期"、"2024年模拟考"）
3. 输入索引号（默认会自动填充下一个可用的索引号）
4. 选择考试截图并上传
5. 系统会自动识别并保存数据

### 为考试记录评分
1. 进入考试列表页面
2. 在"星级"列中点击星星即可评分
3. 支持半星评分，点击星星的左半部分为半星
4. 评分会立即保存

### 修改索引号
1. 进入考试列表页面
2. 点击要修改的记录的"编辑"按钮
3. 修改索引号（必须是唯一的正整数）
4. 点击"保存"按钮
5. 系统会验证索引号是否重复

### 修改考试名称
1. 进入考试列表页面
2. 点击要修改的记录的"编辑"按钮
3. 修改考试名称
4. 点击"保存"按钮

## 技术细节

### 使用的技术
- Ant Design Rate 组件 - 星级评分
- Supabase 数据库 - 数据存储
- TypeScript - 类型安全
- React - 前端框架

### 数据验证
- 考试名称：非空，最多50个字符
- 索引号：必须大于0，必须唯一
- 星级：0-5之间，支持0.5的步长

### 性能优化
- 索引号字段创建了数据库索引
- 星级更新使用乐观更新，立即反馈给用户
- 所有查询都按索引号排序，保证一致性

## 兼容性说明

- 保留了原有的 `exam_number` 字段，确保向后兼容
- 旧数据会自动使用 `exam_number` 作为默认的 `index_number`
- 旧数据的 `exam_name` 会显示为"第X期"格式
- 所有旧功能继续正常工作

## 测试状态

- ✅ 数据库迁移成功
- ✅ 类型定义更新完成
- ✅ API 函数测试通过
- ✅ 页面功能测试通过
- ✅ Lint 检查通过
- ✅ 向后兼容性验证通过
