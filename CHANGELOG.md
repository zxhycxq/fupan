# 更新日志

## 2025-11-22 - 改用文字识别API

### 重要变更
- 🔄 **移除图像内容理解插件**: 改用通用文字识别(高精度版)API
  - 移除异步轮询逻辑
  - 改为同步直接调用
  - 提高识别速度和稳定性
  - 减少等待时间

### 技术改进
- 📝 使用通用文字识别(高精度版)API
  - API endpoint: `/api/miaoda/runtime/apicenter/source/proxy/6KmAKxK9aE29irAwt32QRk`
  - Content-Type: application/x-www-form-urlencoded
  - 支持中英文混合识别
  - 直接返回识别结果,无需轮询
  
- 📝 更新类型定义
  - 添加OcrRequest和OcrResponse类型
  - 移除ImageRecognitionRequest等旧类型
  
- 📝 简化识别流程
  - 移除submitImageRecognition和pollImageRecognitionResult
  - 新增recognizeText函数,一次调用即可获取结果
  - 减少网络请求次数

### 优化改进
- ⚡ **识别速度提升**: 从异步轮询改为同步调用,大幅减少等待时间
- ⚡ **稳定性提升**: 移除轮询超时问题,识别更加稳定可靠
- ⚡ **代码简化**: 移除复杂的轮询逻辑,代码更加简洁易维护

## 2025-11-22 - Bug修复和图片处理优化

### Bug修复
- 🐛 **修复React Router错误**: 修复"Cannot read properties of null (reading 'useRef')"错误
  - 将BrowserRouter从App.tsx移到main.tsx
  - 确保Router在正确的React上下文中初始化
  - 遵循React Router最佳实践

- 🐛 **改进图片识别错误处理**: 优化"recognize error"错误提示
  - 添加详细的错误日志输出
  - 提供更友好的错误信息
  - 改进错误重试逻辑
  - 避免无意义的重试

### 新增功能
- ✅ **智能图片压缩**: 自动压缩大图片,提高识别成功率
  - 自动检测图片大小
  - 大于2MB的图片自动压缩
  - 保持图片清晰度的同时减小文件大小
  - 压缩后的图片更容易被识别
  - 显示压缩前后的大小对比

- ✅ **多图片上传**: 支持一次性上传多张考试成绩截图
  - 可以同时选择多张图片
  - 每张图片独立预览,带序号标识
  - 支持单独删除某张图片
  - 支持一键清空所有图片
  
- ✅ **上传进度显示**: 添加详细的上传进度反馈
  - 实时显示当前处理步骤
  - 显示压缩、识别等详细状态
  - 进度条显示整体完成百分比
  - 提示用户耐心等待

- ✅ **测试数据生成**: 新增数据生成功能
  - 可以快速生成模拟考试数据
  - 支持生成1-20条考试记录
  - 每条记录包含完整的模块数据
  - 方便测试和演示

### 优化改进
- 🔧 **图片处理优化**:
  - 添加智能压缩功能
  - 自动调整图片大小和质量
  - 保持文字清晰度
  - 减少识别失败率
  - 提高处理速度

- 🔧 **用户体验优化**:
  - 上传过程中禁用文件选择和删除操作
  - 添加图片序号标识,方便识别顺序
  - 优化提示文案,更加友好
  - 提供详细的错误提示和解决建议
  - 显示图片处理的详细步骤

- 🔧 **调试优化**:
  - 添加详细的控制台日志
  - 输出识别状态和错误信息
  - 显示图片压缩信息
  - 便于问题排查和调试

### 技术改进
- 📝 更新类型定义,支持多文件管理
- 📝 优化错误处理逻辑
- 📝 改进进度计算算法
- 📝 添加内存清理机制(URL.revokeObjectURL)
- 📝 修复React Router初始化问题
- 📝 增强错误日志和调试信息
- 📝 实现Canvas图片压缩功能
- 📝 优化图片处理流程

### 文档更新
- 📚 更新用户指南,说明多图片上传功能
- 📚 添加使用建议和注意事项
- 📚 添加更新日志
- 📚 创建故障排查指南
- 📚 提供常见问题解决方案
- 📚 添加图片质量要求说明
- 📚 补充图片压缩相关说明

## 初始版本

### 核心功能
- ✅ 图片上传和OCR识别
- ✅ 考试数据解析
- ✅ 数据可视化仪表板
- ✅ 考试记录管理
- ✅ 详细成绩分析
- ✅ 弱势模块识别
