# 任务: 完善系统功能

## 当前任务

### 1. 添加模块趋势折线图 ✅
- [x] 在Dashboard添加模块趋势图
- [x] 获取所有考试的模块数据
- [x] 按时间顺序排序
- [x] 为每个主模块绘制折线
- [x] 添加图例和tooltip
- [x] 创建getModuleTrendData API函数
- [x] 配置ECharts折线图
- [x] 添加平滑曲线和连接空值
- [x] 图表独占一行(md:col-span-2)
- [x] 添加左右间隙(boundaryGap)
- [x] 优化布局以支持最多50个数据点

### 2. 添加考试倒计时 ✅
- [x] 在设置页面添加考试配置
- [x] 支持选择考试类型(国考/省考)
- [x] 支持设置考试日期
- [x] 在Header添加倒计时显示(全局可见)
- [x] 计算剩余天数
- [x] 数据库存储考试配置
- [x] 添加API函数
- [x] 更新类型定义
- [x] 渐变背景和边框样式

### 3. 响应式设计优化 ✅
- [x] Header移动端适配
  - [x] 添加汉堡菜单(Menu/X图标)
  - [x] 移动端显示简短标题
  - [x] 考试倒计时在移动端显示在菜单中
  - [x] 响应式导航栏
- [x] Dashboard图表适配
  - [x] 响应式图表高度(移动端300px)
  - [x] 调整字体大小(移动端10-14px)
  - [x] 优化图表边距和间距
  - [x] 饼图图例位置调整
  - [x] 轴标签旋转角度优化
- [x] 卡片标题响应式字体
- [x] 所有页面移动端测试

### 4. 改进OCR识别精确度 ⏳
- [ ] 测试当前识别效果
- [ ] 根据实际OCR结果调整正则表达式
- [ ] 添加更多容错匹配模式

### 5. 添加图表说明功能 ✅
- [x] 创建TitleWithTooltip组件
- [x] 在各模块正确率图表添加说明
- [x] 在各模块用时对比图表添加说明
- [x] 在模块详细数据表格添加说明
- [x] 使用Info图标和Tooltip组件

### 6. 考试备注和报告链接功能 ✅
- [x] 添加考试备注字段和编辑功能
- [x] 添加考试日期编辑功能
- [x] 添加考试报告链接字段
- [x] 在标题区域显示报告链接
- [x] 支持新窗口打开链接
- [x] 添加URL格式验证
- [x] 改进错误消息显示

### 7. 数据库字段问题排查 ⏳
**问题**: 保存备注和报告链接失败
**已完成**:
- [x] 创建数据库迁移文件
- [x] 添加notes、exam_date、report_url字段
- [x] 添加约束和索引
- [x] 改进错误消息显示详细信息

**待确认**:
- [ ] 确认迁移是否已执行
- [ ] 检查数据库表结构
- [ ] 检查RLS策略
- [ ] 测试实际保存功能

**调试步骤**:
1. 打开浏览器开发者工具(F12)
2. 切换到Console标签
3. 尝试保存备注或报告链接
4. 查看控制台输出的详细错误信息
5. 根据错误信息确定问题原因

**常见错误**:
- "column does not exist": 字段不存在,需要执行迁移
- "permission denied": 权限问题,需要检查RLS策略
- "violates check constraint": 违反约束(备注长度>500字或日期>今天)

## 已完成

### 雷达图tooltip优化 ✅
- [x] 修改tooltip显示逻辑
- [x] 只显示当前hover项的数据
- [x] 显示"我的"值和"目标"值
- [x] 添加颜色标识
- [x] 优化显示格式

### 编辑考试用时功能 ✅
- [x] 在用时卡片添加编辑按钮
- [x] 创建编辑用时Dialog
- [x] 实现用时更新功能(分钟输入)
- [x] 添加表单验证
- [x] 更新本地状态
- [x] 显示保存状态

### 调整菜单结构 ✅
- [x] 删除"生成数据"菜单
- [x] 将"目标设置"改为"设置"
- [x] 更新路由配置
- [x] 调整设置页面布局

### 改进雷达图显示 ✅
- [x] 获取用户目标设置
- [x] 在雷达图添加目标数据系列(红色虚线)
- [x] 保持实际数据系列(橙色填充)
- [x] 添加图例说明(我的/目标)
- [x] 优化颜色和样式

### 用时输入改进 ✅
- [x] 修改上传表单,用时改为分钟输入
- [x] 添加输入验证(只允许数字)
- [x] 后台自动转换分钟为秒数
- [x] 更新dataParser函数签名

### 全局设置页面 ✅
- [x] 创建Settings页面组件
- [x] 添加6大模块的目标正确率设置表单
- [x] 实现保存设置功能
- [x] 添加路由配置
- [x] 添加加载和保存状态
- [x] 添加表单验证
- [x] 添加恢复默认功能

### 数据库设计 ✅
- [x] 创建user_settings表
- [x] 添加difficulty和beat_percentage字段
- [x] 应用所有数据库迁移

### 详情页面优化 ✅
- [x] 显示难度系数
- [x] 显示平均分
- [x] 显示击败百分比
- [x] 显示最高分
- [x] 优化响应式布局

## 注意事项
- 所有UI文本使用中文
- 确保表单验证完善
- 保持代码整洁和注释清晰
- OCR识别需要根据实际效果持续优化
- 雷达图颜色: 橙色(我的) + 红色虚线(目标)
- 用时编辑: 分钟输入,自动转换为秒数存储

